<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Chat Bot</title>
    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <!-- Tailwind CSS (for utility classes) -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Font Awesome for icons -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        /* Custom CSS */
        #chat-widget {
            transition: all 0.3s ease;
            height: 400px;
            display: flex;
            flex-direction: column;
        }
        #chat-log {
            flex-grow: 1;
            background-color: #f9f9f9;
        }
        .chat-message {
            max-width: 80%;
            padding: 8px 12px;
            border-radius: 12px;
            margin-bottom: 8px;
            word-wrap: break-word;
        }
        .user-message {
            background-color: #e3f2fd;
            margin-left: auto;
            border-bottom-right-radius: 4px;
        }
        .bot-message {
            background-color: #f1f1f1;
            margin-right: auto;
            border-bottom-left-radius: 4px;
        }
        #chat-input {
            transition: all 0.3s ease;
        }
        #chat-input:focus {
            box-shadow: none;
            border-color: #86b7fe;
        }
        .typing-indicator {
            display: inline-flex;
        }
        .typing-dot {
            width: 8px;
            height: 8px;
            background-color: #6b7280;
            border-radius: 50%;
            margin: 0 2px;
            animation: typingAnimation 1.4s infinite ease-in-out;
        }
        .typing-dot:nth-child(1) {
            animation-delay: 0s;
        }
        .typing-dot:nth-child(2) {
            animation-delay: 0.2s;
        }
        .typing-dot:nth-child(3) {
            animation-delay: 0.4s;
        }
        @keyframes typingAnimation {
            0%, 60%, 100% { transform: translateY(0); }
            30% { transform: translateY(-5px); }
        }
    </style>
</head>
<body>

<!-- Chat Widget -->
<div id="chat-widget" class="fixed bottom-6 right-6 bg-white border border-gray-200 shadow-xl rounded-lg w-80 hidden flex-col z-50">
    <div class="p-3 border-b bg-primary text-white font-semibold rounded-t-lg flex justify-between items-center">
        <span>AI Assistant</span>
        <button onclick="document.getElementById('chat-widget').classList.add('hidden')" class="text-white hover:text-gray-200">
            <i class="fas fa-times"></i>
        </button>
    </div>
    <div id="chat-log" class="p-3 overflow-y-auto">
        <div class="text-center text-sm text-gray-500 mb-2">Ask me anything!</div>
    </div>
    <div class="p-3 border-t bg-gray-50 rounded-b-lg">
        <div class="input-group">
            <input id="chat-input" type="text" placeholder="Type your message..." 
                   class="form-control border-gray-300 focus:border-blue-500 focus:ring-1 focus:ring-blue-500 rounded-l-lg">
            <button id="chat-send" class="btn btn-primary rounded-r-lg">
                <i class="fas fa-paper-plane"></i>
            </button>
        </div>
    </div>
</div>

<!-- Chat Toggle Button -->
<button id="chat-toggle" class="fixed bottom-6 right-6 bg-primary text-white p-3 rounded-full shadow-lg z-50 hover:bg-blue-700 transition-all">
    <i class="fas fa-comment-dots text-xl"></i>
</button>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
<script>
document.addEventListener("DOMContentLoaded", function () {
    const input = document.getElementById('chat-input');
    const log = document.getElementById('chat-log');
    const sendBtn = document.getElementById('chat-send');
    const chatWidget = document.getElementById('chat-widget');
    const chatToggle = document.getElementById('chat-toggle');

    // Toggle chat widget
    chatToggle.addEventListener('click', function() {
        chatWidget.classList.toggle('hidden');
        if (!chatWidget.classList.contains('hidden')) {
            input.focus();
        }
    });

    // Send message on Enter key
    input.addEventListener('keypress', function(e) {
        if (e.key === 'Enter') {
            sendMessage();
        }
    });

    // Send message on button click
    sendBtn.addEventListener('click', sendMessage);

    function sendMessage() {
        const question = input.value.trim();
        if (!question) return;

        // Add user message to chat log
        addMessage(question, 'user');
        input.value = '';
        
        // Show typing indicator
        const typingId = showTypingIndicator();
        
        // Simulate API call (replace with actual fetch)
        simulateApiCall(question, typingId);
        
        // In a real implementation, you would use:
        /*
        fetch("/chatbot/ask/", {
            method: "POST",
            headers: {
                'Content-Type': 'application/x-www-form-urlencoded',
                'X-CSRFToken': '{{ csrf_token }}',
            },
            body: `question=${encodeURIComponent(question)}`
        })
        .then(res => res.json())
        .then(data => {
            removeTypingIndicator(typingId);
            const answer = data.answer || data.error || "Sorry, I couldn't understand that.";
            addMessage(answer, 'bot');
        })
        .catch(() => {
            removeTypingIndicator(typingId);
            addMessage("Error connecting to chatbot service. Please try again later.", 'error');
        });
        */
    }

    function addMessage(text, sender) {
        const messageDiv = document.createElement('div');
        messageDiv.className = `chat-message ${sender}-message`;
        
        const senderName = sender === 'user' ? 'You' : 'AI';
        const icon = sender === 'user' ? 'user' : 'robot';
        
        messageDiv.innerHTML = `
            <div class="font-semibold text-xs text-gray-500 mb-1">${senderName}</div>
            <div>${text}</div>
        `;
        
        log.appendChild(messageDiv);
        log.scrollTop = log.scrollHeight;
    }

    function showTypingIndicator() {
        const typingDiv = document.createElement('div');
        typingDiv.className = 'chat-message bot-message';
        typingDiv.id = 'typing-indicator';
        typingDiv.innerHTML = `
            <div class="font-semibold text-xs text-gray-500 mb-1">AI</div>
            <div class="typing-indicator">
                <span class="typing-dot"></span>
                <span class="typing-dot"></span>
                <span class="typing-dot"></span>
            </div>
        `;
        log.appendChild(typingDiv);
        log.scrollTop = log.scrollHeight;
        return 'typing-indicator';
    }

    function removeTypingIndicator(id) {
        const indicator = document.getElementById(id);
        if (indicator) {
            indicator.remove();
        }
    }

    // Simulation function for demo purposes
    function simulateApiCall(question, typingId) {
        // Simulate network delay
        setTimeout(() => {
            removeTypingIndicator(typingId);
            
            // Simple response logic for demo
            let response;
            if (question.toLowerCase().includes('hello') || question.toLowerCase().includes('hi')) {
                response = "Hello there! How can I help you today?";
            } else if (question.toLowerCase().includes('help')) {
                response = "I'm here to assist you. What specific questions do you have?";
            } else if (question.toLowerCase().includes('thank')) {
                response = "You're welcome! Is there anything else I can help with?";
            } else {
                response = "I understand you're asking about: " + question + ". For more detailed assistance, please contact our support team.";
            }
            
            addMessage(response, 'bot');
        }, 1000 + Math.random() * 2000); // Random delay between 1-3 seconds
    }
});
</script>
</body>
</html>